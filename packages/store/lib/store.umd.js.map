{"version":3,"file":"store.umd.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useReducer, Dispatch, Reducer } from 'react';\n\ntype Callback = () => unknown;\n\nexport interface Action<State, ActionType> {\n  type: ActionType;\n  payload: {\n    data: State;\n  };\n}\n\nconst useForceUpdate = () => useReducer(state => !state, false)[1];\n\nconst createStoreHook = <State, ActionType>(\n  reducer: Reducer<State, Action<State, ActionType>>,\n  initialState: State,\n): (() => [State, Dispatch<Action<State, ActionType>>]) => {\n  const subscribers: Callback[] = [];\n  let state: State = initialState;\n  const dispatch: Dispatch<Action<State, ActionType>> = (action: Action<State, ActionType>) :Promise<State> => {\n    state = reducer(state, action);\n    subscribers.forEach((callback: Callback) => callback());\n    return new Promise<State>(resolve => {\n      resolve({...state});\n    });\n  };\n  const useSharedState = (): [State, Dispatch<Action<State, ActionType>>] => {\n    const forceUpdate = useForceUpdate();\n    useEffect(() => {\n      const callback: Callback = () => forceUpdate();\n      subscribers.push(callback);\n      callback();\n      const cleanup = () => {\n        const index = subscribers.indexOf(callback);\n        subscribers.splice(index, 1);\n      };\n      return cleanup;\n    }, []);\n    return [{...state}, dispatch];\n  };\n  return useSharedState;\n};\n\nexport default createStoreHook;\n"],"names":["reducer","initialState","subscribers","state","dispatch","action","forEach","callback","Promise","resolve","Object","assign","forceUpdate","useReducer","useEffect","push","index","indexOf","splice"],"mappings":"sSAawB,CACtBA,EACAC,KAEA,MAAMC,EAA0B,GAChC,IAAIC,EAAeF,EACnB,MAAMG,EAAiDC,IACrDF,EAAQH,EAAQG,EAAOE,GACvBH,EAAYI,SAASC,GAAuBA,MACrC,IAAIC,SAAeC,IACxBA,EAAOC,OAAAC,OAAA,CAAA,EAAKR,GAAO,KAiBvB,MAduB,KACrB,MAAMS,EAhBmBC,EAAAA,YAAWV,IAAUA,IAAO,GAAO,GA2B5D,OAVAW,EAAAA,WAAU,KACR,MAAMP,EAAqB,IAAMK,IACjCV,EAAYa,KAAKR,GACjBA,IAKA,MAJgB,KACd,MAAMS,EAAQd,EAAYe,QAAQV,GAClCL,EAAYgB,OAAOF,EAAO,EAAE,CAEhB,GACb,IACI,CAAKN,OAAAC,OAAA,CAAA,EAAAR,GAAQC,EAAS,CAEV"}