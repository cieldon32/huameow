{"version":3,"file":"store.cjs.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useReducer, Dispatch, Reducer } from 'react';\n\ntype Callback = () => unknown;\n\nexport interface Action<State, ActionType> {\n  type: ActionType;\n  payload: {\n    data: State;\n  };\n}\n\nconst useForceUpdate = () => useReducer(state => !state, false)[1];\n\nconst createStoreHook = <State, ActionType>(\n  reducer: Reducer<State, Action<State, ActionType>>,\n  initialState: State,\n): (() => [State, Dispatch<Action<State, ActionType>>]) => {\n  const subscribers: Callback[] = [];\n  let state: State = initialState;\n  const dispatch: Dispatch<Action<State, ActionType>> = (action: Action<State, ActionType>) :Promise<State> => {\n    state = reducer(state, action);\n    subscribers.forEach((callback: Callback) => callback());\n    return new Promise<State>(resolve => {\n      resolve({...state});\n    });\n  };\n  const useSharedState = (): [State, Dispatch<Action<State, ActionType>>] => {\n    const forceUpdate = useForceUpdate();\n    useEffect(() => {\n      const callback: Callback = () => forceUpdate();\n      subscribers.push(callback);\n      callback();\n      const cleanup = () => {\n        const index = subscribers.indexOf(callback);\n        subscribers.splice(index, 1);\n      };\n      return cleanup;\n    }, []);\n    return [{...state}, dispatch];\n  };\n  return useSharedState;\n};\n\nexport default createStoreHook;\n"],"names":["useReducer","useEffect"],"mappings":";;;;;;AAWA,MAAM,cAAc,GAAG,MAAMA,gBAAU,CAAC,KAAK,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAEnE,MAAM,eAAe,GAAG,CACtB,OAAkD,EAClD,YAAmB,KACqC;IACxD,MAAM,WAAW,GAAe,EAAE,CAAC;IACnC,IAAI,KAAK,GAAU,YAAY,CAAC;AAChC,IAAA,MAAM,QAAQ,GAAwC,CAAC,MAAiC,KAAoB;AAC1G,QAAA,KAAK,GAAG,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QAC/B,WAAW,CAAC,OAAO,CAAC,CAAC,QAAkB,KAAK,QAAQ,EAAE,CAAC,CAAC;AACxD,QAAA,OAAO,IAAI,OAAO,CAAQ,OAAO,IAAG;YAClC,OAAO,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EAAK,KAAK,CAAA,CAAE,CAAC;AACtB,SAAC,CAAC,CAAC;AACL,KAAC,CAAC;IACF,MAAM,cAAc,GAAG,MAAmD;AACxE,QAAA,MAAM,WAAW,GAAG,cAAc,EAAE,CAAC;QACrCC,eAAS,CAAC,MAAK;AACb,YAAA,MAAM,QAAQ,GAAa,MAAM,WAAW,EAAE,CAAC;AAC/C,YAAA,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC3B,YAAA,QAAQ,EAAE,CAAC;YACX,MAAM,OAAO,GAAG,MAAK;gBACnB,MAAM,KAAK,GAAG,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5C,gBAAA,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;AAC/B,aAAC,CAAC;AACF,YAAA,OAAO,OAAO,CAAC;SAChB,EAAE,EAAE,CAAC,CAAC;AACP,QAAA,OAAO,CAAK,MAAA,CAAA,MAAA,CAAA,EAAA,EAAA,KAAK,CAAG,EAAA,QAAQ,CAAC,CAAC;AAChC,KAAC,CAAC;AACF,IAAA,OAAO,cAAc,CAAC;AACxB;;;;"}